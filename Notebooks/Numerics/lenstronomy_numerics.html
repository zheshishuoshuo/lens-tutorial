
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>lenstronomy numerics &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Notebooks/Numerics/lenstronomy_numerics';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SimulationAPI" href="../Simulations/simulation_api.html" />
    <link rel="prev" title="lenstronomy lens equation solver and flux ratios computation example notebook" href="solving_lens_equation_and_computing_flux_ratios.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../starting_guide.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../starting_guide.html">
                    lenstronomy starting guide
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/starting_guide.html"><em>lenstronomy</em> starting guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/units_coordinates_parameters_definitions.html">Units, coordiante system and parameter definitions in lenstronomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/fits_handling_and_extracting_needed_information_from_the_data.html">FITS handling and extracting needed information from the data prior to modeling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lens Modeling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../LensModeling/modeling_a_simple_Einstein_ring.html">Simple ring parameter constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LensModeling/modeling_a_doubly_imaged_quasar.html">Double modelling notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LensModeling/modeling_a_quadruply_imaged_quasar.html">Quad modelling notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LensModeling/modeling_multiple_bands_simultaneously.html">Multi-band fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LensModeling/source_reconstruction_with_shapelets.html">Shapelet source reconstruction</a></li>

<li class="toctree-l1"><a class="reference internal" href="../LensModeling/modelling_of_catalogue_data.html">Modelling of catalogue data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LensModeling/cosmic_shear_with_Einstein_ring_simulations.html">Cosmic shear with Einstein ring simulations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Line-of-Sight Effects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../LineOfSightEffects/line-of-sight_effects_tutorial.html">Line-of-sight effects in <code class="docutils literal notranslate"><span class="pre">lenstronomy</span></code></a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Numerics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="solving_lens_equation_and_computing_flux_ratios.html">lenstronomy lens equation solver and flux ratios computation example notebook</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">lenstronomy numerics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simulations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Simulations/simulation_api.html">SimulationAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Simulations/skypy_meets_lenstronomy.html">Skypy meets lenstronomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Simulations/simulating_different_telescopes.html">Simulating different telescopes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Galaxy Light Fitting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Galaxies/galfitting_with_lenstronomy.html">“Galfitting” with lenstronomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Galaxies/quasar_host_galaxy_decomposition.html">Quasar-host galaxy decomposition</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dark Matter Substructure</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../DMSubstructure/substructure_challenge_simple_example.html">Substructure challenge - a simple example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../DMSubstructure/substructure_challenge_mock_production.html">Substructure Challenge - Mock production notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time-Delay Cosmography</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../TimeDelayCosmography/time_delay_cosmography_simulations.html">Time delay-cosmography simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TimeDelayCosmography/time_delay_cosmography_with_uncertain_psf.html">Time delay-cosmography with uncertain PSF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TimeDelayCosmography/sampling_of_catalogue_data_with_external_information.html">Sampling of catalogue data with external information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TimeDelayCosmography/cosmology_sampling_of_cosmographic_posteriors.html">Cosmology sampling of cosmographic posteriors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../TimeDelayCosmography/cosmographic_uncertainty_estimation_and_forecasting_with_kinematics.html">Cosmographic uncertainty estimation and forecasting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Clusters</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Clusters/clusters.html">Clusters</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FNotebooks/Numerics/lenstronomy_numerics.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Notebooks/Numerics/lenstronomy_numerics.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>lenstronomy numerics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-example">set up the example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-convolved-image-with-different-numerical-settings">computing convolved image with different numerical settings</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lenstronomy-numerics">
<h1>lenstronomy numerics<a class="headerlink" href="#lenstronomy-numerics" title="Link to this heading">#</a></h1>
<p>In this notebook we use the different convolution and super-sampling approximations in lenstronomy. The different approximations are described and demonstrated on the use-case of a single Sersic profile. The example is also been used to compare the computational speed and accuracy of the different approximations. Please note that performance and accuracy depend on the specific use case and an optimal choice is upon the discretion and responsibility of the user.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">astropy.io.fits</span> <span class="k">as</span> <span class="nn">pyfits</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># make sure lenstronomy is installed, otherwise install the latest pip version</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">lenstronomy</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>lenstronomy

<span class="kn">import</span> <span class="nn">lenstronomy.Util.util</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">import</span> <span class="nn">lenstronomy.Util.kernel_util</span> <span class="k">as</span> <span class="nn">kernel_util</span>
</pre></div>
</div>
</div>
</div>
<section id="set-up-the-example">
<h2>set up the example<a class="headerlink" href="#set-up-the-example" title="Link to this heading">#</a></h2>
<p>We use a single elliptical Sersic profile and a TinyTim PSF as our example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we define a model consisting of a singe Sersric profile</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LightModel.light_model</span> <span class="kn">import</span> <span class="n">LightModel</span>
<span class="n">light_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SERSIC_ELLIPSE&#39;</span><span class="p">]</span>
<span class="n">lightModel</span> <span class="o">=</span> <span class="n">LightModel</span><span class="p">(</span><span class="n">light_model_list</span><span class="o">=</span><span class="n">light_model_list</span><span class="p">)</span>
<span class="n">kwargs_light</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;amp&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>

<span class="c1"># we define a pixel grid and a higher resolution super sampling factor</span>
<span class="n">supersampling_factor</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">numPix</span> <span class="o">=</span> <span class="mi">61</span>  <span class="c1">#  cutout pixel size</span>
<span class="n">deltaPix</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1">#  pixel size in arcsec (area per pixel = deltaPix**2)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ra_at_xy_0</span><span class="p">,</span> <span class="n">dec_at_xy_0</span><span class="p">,</span> <span class="n">x_at_radec_0</span><span class="p">,</span> <span class="n">y_at_radec_0</span><span class="p">,</span> <span class="n">Mpix2coord</span><span class="p">,</span> <span class="n">Mcoord2pix</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">make_grid_with_coordtransform</span><span class="p">(</span>
            <span class="n">numPix</span><span class="o">=</span><span class="n">numPix</span><span class="p">,</span> <span class="n">deltapix</span><span class="o">=</span><span class="n">deltaPix</span><span class="p">,</span> <span class="n">subgrid_res</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">left_lower</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">lightModel</span><span class="o">.</span><span class="n">surface_brightness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kwargs_list</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">array2image</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
<span class="n">flux_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
<span class="n">conv_pixels_partial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numPix</span><span class="p">,</span> <span class="n">numPix</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">conv_pixels_partial</span><span class="p">[</span><span class="n">flux</span> <span class="o">&gt;=</span> <span class="n">flux_max</span><span class="o">/</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">conv_pixels_partial</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>146
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import PSF file</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">dirpath</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">module_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="n">psf_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">module_path</span><span class="p">,</span> <span class="s1">&#39;Data/PSF_TinyTim/psf_example.fits&#39;</span><span class="p">)</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">psf_filename</span><span class="p">)</span>

<span class="n">kernel_size</span> <span class="o">=</span> <span class="mi">91</span>

<span class="n">kernel_super</span> <span class="o">=</span> <span class="n">kernel_util</span><span class="o">.</span><span class="n">subgrid_kernel</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">num_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">subgrid_res</span><span class="o">=</span><span class="n">supersampling_factor</span><span class="p">,</span> <span class="n">odd</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">psf_size_super</span> <span class="o">=</span> <span class="n">kernel_size</span><span class="o">*</span><span class="n">supersampling_factor</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">kernel_super</span><span class="p">))</span>
<span class="k">if</span> <span class="n">psf_size_super</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">psf_size_super</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">kernel_super</span> <span class="o">=</span> <span class="n">kernel_util</span><span class="o">.</span><span class="n">cut_psf</span><span class="p">(</span><span class="n">psf_data</span><span class="o">=</span><span class="n">kernel_super</span><span class="p">,</span> <span class="n">psf_size</span><span class="o">=</span><span class="n">psf_size_super</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">kernel_super</span><span class="p">))</span>


<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kernel_super</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># make instance of the PixelGrid class</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Data.pixel_grid</span> <span class="kn">import</span> <span class="n">PixelGrid</span>
<span class="n">kwargs_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nx&#39;</span><span class="p">:</span> <span class="n">numPix</span><span class="p">,</span> <span class="s1">&#39;ny&#39;</span><span class="p">:</span> <span class="n">numPix</span><span class="p">,</span> <span class="s1">&#39;transform_pix2angle&#39;</span><span class="p">:</span> <span class="n">Mpix2coord</span><span class="p">,</span> <span class="s1">&#39;ra_at_xy_0&#39;</span><span class="p">:</span> <span class="n">ra_at_xy_0</span><span class="p">,</span> <span class="s1">&#39;dec_at_xy_0&#39;</span><span class="p">:</span> <span class="n">dec_at_xy_0</span><span class="p">}</span>
<span class="n">pixel_grid</span> <span class="o">=</span> <span class="n">PixelGrid</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(735, 735)
(455, 455)
</pre></div>
</div>
<img alt="../../_images/83b696a59a1733f3df486b9e6d6f1d46f1550f2f000eefd52553a91b443aec8f.png" src="../../_images/83b696a59a1733f3df486b9e6d6f1d46f1550f2f000eefd52553a91b443aec8f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make instance of the PSF class</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Data.psf</span> <span class="kn">import</span> <span class="n">PSF</span>
<span class="n">kwargs_psf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;psf_type&#39;</span><span class="p">:</span> <span class="s1">&#39;PIXEL&#39;</span><span class="p">,</span> <span class="s1">&#39;kernel_point_source&#39;</span><span class="p">:</span> <span class="n">kernel_super</span><span class="p">,</span> <span class="s1">&#39;point_source_supersampling_factor&#39;</span><span class="p">:</span> <span class="n">supersampling_factor</span><span class="p">}</span>
<span class="n">psf_class</span> <span class="o">=</span> <span class="n">PSF</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_psf</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">psf_class</span><span class="o">.</span><span class="n">kernel_point_source</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">psf_class</span><span class="o">.</span><span class="n">kernel_point_source</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">psf_class</span><span class="o">.</span><span class="n">kernel_point_source_supersampled</span><span class="p">(</span><span class="n">supersampling_factor</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/sibirrer/Library/Python/3.6/lib/python/site-packages/ipykernel_launcher.py:6: RuntimeWarning: divide by zero encountered in log
  
</pre></div>
</div>
<img alt="../../_images/d7b3e39f4ebb178c0749b2e48c9ff387675a244ccc2786924d8b13cf20bfcdf7.png" src="../../_images/d7b3e39f4ebb178c0749b2e48c9ff387675a244ccc2786924d8b13cf20bfcdf7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(93, 93)
(455, 455)
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-convolved-image-with-different-numerical-settings">
<h2>computing convolved image with different numerical settings<a class="headerlink" href="#computing-convolved-image-with-different-numerical-settings" title="Link to this heading">#</a></h2>
<p>Now we define different numerical settings, kwargs_numerics, that are imported into the ImageModel class to perform the image computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timeit</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># profiling boolean</span>

<span class="c1"># high resolution ray-tracing and high resolution convolution, the full calculation</span>
<span class="n">kwargs_numerics_true</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="n">supersampling_factor</span><span class="p">,</span> <span class="c1"># super sampling factor of (partial) high resolution ray-tracing</span>
                        <span class="s1">&#39;compute_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;regular&#39;</span><span class="p">,</span> <span class="c1"># &#39;regular&#39; or &#39;adaptive&#39;</span>
                        <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># bool, if True, performs the supersampled convolution (either on regular or adaptive grid)</span>
                        <span class="s1">&#39;supersampling_kernel_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># size of the higher resolution kernel region (can be smaller than the original kernel). None leads to use the full size</span>
                        <span class="s1">&#39;flux_evaluate_indexes&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># bool mask, if None, it will evaluate all (sub) pixels</span>
                        <span class="s1">&#39;supersampled_indexes&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># bool mask of pixels to be computed in supersampled grid (only for adaptive mode)</span>
                        <span class="s1">&#39;compute_indexes&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># bool mask of pixels to be computed the PSF response (flux being added to). Only used for adaptive mode and can be set =likelihood mask.</span>
                        <span class="s1">&#39;point_source_supersampling_factor&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># int, supersampling factor when rendering a point source (not used in this script)</span>
                       <span class="p">}</span>


<span class="c1"># high resolution convolution on a smaller PSF with low resolution convolution on the edges of the PSF and high resolution ray tracing</span>
<span class="n">kwargs_numerics_high_res_narrow</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="n">supersampling_factor</span><span class="p">,</span>
                        <span class="s1">&#39;compute_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;regular&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s1">&#39;supersampling_kernel_size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> 
                       <span class="p">}</span>


<span class="c1"># low resolution convolution based on high resolution ray-tracing grid</span>
<span class="n">kwargs_numerics_low_conv_high_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="n">supersampling_factor</span><span class="p">,</span>
                        <span class="s1">&#39;compute_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;regular&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                        <span class="s1">&#39;supersampling_kernel_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                       <span class="p">}</span>


<span class="c1"># low resolution convolution with a subset of pixels with high resolution ray-tracing</span>
<span class="n">kwargs_numerics_low_conv_high_adaptive</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="n">supersampling_factor</span><span class="p">,</span>
                        <span class="s1">&#39;compute_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;adaptive&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                        <span class="s1">&#39;supersampling_kernel_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                        <span class="s1">&#39;supersampled_indexes&#39;</span><span class="p">:</span> <span class="n">conv_pixels_partial</span><span class="p">,</span>
                       <span class="p">}</span>


<span class="c1"># low resolution convolution with a subset of pixels with high resolution ray-tracing and high resoluton convolution on smaller kernel size</span>
<span class="n">kwargs_numerics_high_adaptive</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="n">supersampling_factor</span><span class="p">,</span>
                        <span class="s1">&#39;compute_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;adaptive&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                        <span class="s1">&#39;supersampling_kernel_size&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                        <span class="s1">&#39;supersampled_indexes&#39;</span><span class="p">:</span> <span class="n">conv_pixels_partial</span><span class="p">,</span>
                       <span class="p">}</span>


<span class="c1"># low resolution convolution and low resolution ray tracing, the simplest calculation</span>
<span class="n">kwargs_numerics_low_res</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s1">&#39;compute_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;regular&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                        <span class="s1">&#39;supersampling_kernel_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># does not matter for supersampling_factor=1</span>
                       <span class="p">}</span>


<span class="kn">from</span> <span class="nn">lenstronomy.ImSim.image_model</span> <span class="kn">import</span> <span class="n">ImageModel</span>

<span class="c1"># without convolution</span>
<span class="n">image_model_true</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="p">,</span> <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics_true</span><span class="p">)</span>
<span class="n">image_unconvolved</span> <span class="o">=</span> <span class="n">image_model_true</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">,</span> <span class="n">unconvolved</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">image_unconvolved</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;log unconvolved&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



<span class="c1"># True computation</span>

<span class="n">image_true</span> <span class="o">=</span> <span class="n">image_model_true</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="k">if</span> <span class="n">timeit</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">%</span><span class="k">timeit</span> image_model_true.image(kwargs_lens_light=kwargs_light)

<span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image_true</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image_true</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">image_true</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;log true&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># high_res_narrow</span>
<span class="n">image_model_high_res_narrow</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="p">,</span> <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics_high_res_narrow</span><span class="p">)</span>
<span class="n">image_high_res_narrow</span> <span class="o">=</span> <span class="n">image_model_high_res_narrow</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="k">if</span> <span class="n">timeit</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">%</span><span class="k">timeit</span> image_model_high_res_narrow.image(kwargs_lens_light=kwargs_light)

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">image_true</span> <span class="o">-</span> <span class="n">image_high_res_narrow</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;true - high res narrow kernle&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># low_conv_high_grid</span>
<span class="n">image_model_low_conv_high_grid</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="p">,</span> <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics_low_conv_high_grid</span><span class="p">)</span>
<span class="n">image_low_conv_high_grid</span> <span class="o">=</span> <span class="n">image_model_low_conv_high_grid</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="k">if</span> <span class="n">timeit</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">%</span><span class="k">timeit</span> image_model_low_conv_high_grid.image(kwargs_lens_light=kwargs_light)

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">image_true</span> <span class="o">-</span> <span class="n">image_low_conv_high_grid</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;true - low conv high grid&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># low_conv_high_adaptive</span>
<span class="n">image_model_low_conv_high_adaptive</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="p">,</span> <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics_low_conv_high_adaptive</span><span class="p">)</span>
<span class="n">image_low_conv_high_adaptive</span> <span class="o">=</span> <span class="n">image_model_low_conv_high_adaptive</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="k">if</span> <span class="n">timeit</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">%</span><span class="k">timeit</span> image_model_low_conv_high_adaptive.image(kwargs_lens_light=kwargs_light)

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">image_true</span> <span class="o">-</span> <span class="n">image_low_conv_high_adaptive</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;true - low conv high adaptive&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># high_adaptive</span>
<span class="n">image_model_high_adaptive</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="p">,</span> <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics_high_adaptive</span><span class="p">)</span>
<span class="n">image_high_adaptive</span> <span class="o">=</span> <span class="n">image_model_high_adaptive</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="k">if</span> <span class="n">timeit</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">%</span><span class="k">timeit</span> image_model_high_adaptive.image(kwargs_lens_light=kwargs_light)

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">image_true</span> <span class="o">-</span> <span class="n">image_high_adaptive</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;true - high adaptive&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># low_res</span>
<span class="n">image_model_low_res</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="p">,</span> <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics_low_res</span><span class="p">)</span>
<span class="n">image_low_res</span> <span class="o">=</span> <span class="n">image_model_low_res</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light</span><span class="p">)</span>
<span class="k">if</span> <span class="n">timeit</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="o">%</span><span class="k">timeit</span> image_model_low_res.image(kwargs_lens_light=kwargs_light)

<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">image_true</span> <span class="o">-</span> <span class="n">image_low_res</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">vmax</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;true - low res&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/befcfc17997df0f0a8dc78afd6ddd7e0879e370f621f9c849aad2f93cab4084b.png" src="../../_images/befcfc17997df0f0a8dc78afd6ddd7e0879e370f621f9c849aad2f93cab4084b.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/sibirrer/Software/lenstronomy/lenstronomy/Data/psf.py:122: Warning: Super-sampled point source kernel over-written due to different subsampling size requested.
  &quot; size requested.&quot;, Warning)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>28.6 ms ± 1.77 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
<img alt="../../_images/8278b104229e7a6a1d1a8e317f3815f191e1f55bf7145bfd6b676ced72425868.png" src="../../_images/8278b104229e7a6a1d1a8e317f3815f191e1f55bf7145bfd6b676ced72425868.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.17 ms ± 237 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
<img alt="../../_images/c912f2e32a6996ace1497dcca5de99aac1bfe4bed138ce9d2109ffe11c2f8d6c.png" src="../../_images/c912f2e32a6996ace1497dcca5de99aac1bfe4bed138ce9d2109ffe11c2f8d6c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.95 ms ± 118 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
<img alt="../../_images/fb9fefe05ff227069fcef5ff665ece51d400d0bd8ffb8525ec8b6011611b2d29.png" src="../../_images/fb9fefe05ff227069fcef5ff665ece51d400d0bd8ffb8525ec8b6011611b2d29.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.34 ms ± 44.5 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
<img alt="../../_images/039ab065cabcf2e3c3801abe69b741e38ed7fc91a5bbd20cf211e1c64d5022f7.png" src="../../_images/039ab065cabcf2e3c3801abe69b741e38ed7fc91a5bbd20cf211e1c64d5022f7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.07 ms ± 117 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
<img alt="../../_images/131afffe0ea81cef99d4b522a372d23807feb4b4f4577ddcbc957933535b26e3.png" src="../../_images/131afffe0ea81cef99d4b522a372d23807feb4b4f4577ddcbc957933535b26e3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>679 µs ± 21.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
<img alt="../../_images/4bd79160ec51b68723747e02306c69a96d489af13cbea313273fd1a9e63c1175.png" src="../../_images/4bd79160ec51b68723747e02306c69a96d489af13cbea313273fd1a9e63c1175.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Notebooks\Numerics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="solving_lens_equation_and_computing_flux_ratios.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">lenstronomy lens equation solver and flux ratios computation example notebook</p>
      </div>
    </a>
    <a class="right-next"
       href="../Simulations/simulation_api.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">SimulationAPI</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-example">set up the example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-convolved-image-with-different-numerical-settings">computing convolved image with different numerical settings</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>