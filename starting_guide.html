
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>lenstronomy starting guide &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'starting_guide';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lenstronomy starting guide" href="Notebooks/GettingStarted/starting_guide.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    lenstronomy starting guide
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/GettingStarted/starting_guide.html"><em>lenstronomy</em> starting guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/GettingStarted/units_coordinates_parameters_definitions.html">Units, coordiante system and parameter definitions in lenstronomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/GettingStarted/fits_handling_and_extracting_needed_information_from_the_data.html">FITS handling and extracting needed information from the data prior to modeling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lens Modeling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/modeling_a_simple_Einstein_ring.html">Simple ring parameter constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/modeling_a_doubly_imaged_quasar.html">Double modelling notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/modeling_a_quadruply_imaged_quasar.html">Quad modelling notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/modeling_multiple_bands_simultaneously.html">Multi-band fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/source_reconstruction_with_shapelets.html">Shapelet source reconstruction</a></li>

<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/modelling_of_catalogue_data.html">Modelling of catalogue data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LensModeling/cosmic_shear_with_Einstein_ring_simulations.html">Cosmic shear with Einstein ring simulations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Line-of-Sight Effects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/LineOfSightEffects/line-of-sight_effects_tutorial.html">Line-of-sight effects in <code class="docutils literal notranslate"><span class="pre">lenstronomy</span></code></a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Numerics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Numerics/solving_lens_equation_and_computing_flux_ratios.html">lenstronomy lens equation solver and flux ratios computation example notebook</a></li>

<li class="toctree-l1"><a class="reference internal" href="Notebooks/Numerics/lenstronomy_numerics.html">lenstronomy numerics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Simulations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Simulations/simulation_api.html">SimulationAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Simulations/skypy_meets_lenstronomy.html">Skypy meets lenstronomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Simulations/simulating_different_telescopes.html">Simulating different telescopes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Galaxy Light Fitting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Galaxies/galfitting_with_lenstronomy.html">“Galfitting” with lenstronomy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Galaxies/quasar_host_galaxy_decomposition.html">Quasar-host galaxy decomposition</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Dark Matter Substructure</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/DMSubstructure/substructure_challenge_simple_example.html">Substructure challenge - a simple example</a></li>

<li class="toctree-l1"><a class="reference internal" href="Notebooks/DMSubstructure/substructure_challenge_mock_production.html">Substructure Challenge - Mock production notebook</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Time-Delay Cosmography</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/TimeDelayCosmography/time_delay_cosmography_simulations.html">Time delay-cosmography simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/TimeDelayCosmography/time_delay_cosmography_with_uncertain_psf.html">Time delay-cosmography with uncertain PSF</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/TimeDelayCosmography/sampling_of_catalogue_data_with_external_information.html">Sampling of catalogue data with external information</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/TimeDelayCosmography/cosmology_sampling_of_cosmographic_posteriors.html">Cosmology sampling of cosmographic posteriors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/TimeDelayCosmography/cosmographic_uncertainty_estimation_and_forecasting_with_kinematics.html">Cosmographic uncertainty estimation and forecasting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Clusters</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Clusters/clusters.html">Clusters</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fstarting_guide.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/starting_guide.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>lenstronomy starting guide</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-lensmodel-module"><span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-plane-lensing">Single plane lensing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-plane-lensing">Multi-plane lensing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lens-equation-solver">lens equation solver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#illustration-of-lens-models">illustration of lens models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-lightmodel-module"><span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> module</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-pointsource-module"><span class="math notranslate nohighlight">\(\texttt{PointSource}\)</span> module</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-data-module"><span class="math notranslate nohighlight">\(\texttt{Data}\)</span> module</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-imsim-module"><span class="math notranslate nohighlight">\(\texttt{ImSim}\)</span> module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-image">Simulate image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-inversion">Linear inversion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-sampling-module"><span class="math notranslate nohighlight">\(\texttt{Sampling}\)</span> Module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-param-class"><span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-likelihood-class"><span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-sampler-class"><span class="math notranslate nohighlight">\(\texttt{Sampler}\)</span> class</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-workflow-module"><span class="math notranslate nohighlight">\(\texttt{Workflow}\)</span> Module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-fittingsequence-class"><span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-lensmodelplot-class"><span class="math notranslate nohighlight">\(\texttt{LensModelPlot}\)</span> class</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-ressources">Further ressources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lenstronomy-starting-guide">
<h1><em>lenstronomy</em> starting guide<a class="headerlink" href="#lenstronomy-starting-guide" title="Link to this heading">#</a></h1>
<p>Welcome to lenstronomy!</p>
<p>This notebook aims to describe the basic functionalities of the most important modules of <em>lenstronomy</em> with some simple examples. More detailed information about the available routines and their use can be accessed through the <a class="reference external" href="https://readthedocs.com/lenstronomy">online documentation</a> and in many other <a class="reference external" href="https://github.com/sibirrer/lenstronomy_extensions">Jupyter notebooks</a>.</p>
<p>Also, we refer to the <a class="reference external" href="https://github.com/sibirrer/strong_lensing_lectures">strong lensing lecture notes</a> in Jupyter form for a brief introduction in strong gravitational lensing.</p>
<div class="alert alert-warning">
<p><strong>Disclamer:</strong> Please reach out to the developers if you have questions! This is true for a beginner in gravitational lensing or have substantial experience with other lensing codes. Your questions and feedback is very valuable for us to improve the software and its documentation.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># some standard python imports #</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># make sure lenstronomy is installed, otherwise install the latest pip version</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">lenstronomy</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>lenstronomy
</pre></div>
</div>
</div>
</div>
<section id="texttt-lensmodel-module">
<h2><span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> module<a class="headerlink" href="#texttt-lensmodel-module" title="Link to this heading">#</a></h2>
<p><span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> and its sub-packages execute all the purely lensing related tasks of <em>lenstronomy</em>. This includes ray-shooting, solving the lens equation, arrival time computation and non-linear solvers to optimize lens models for specific image configurations. The module allows consistent integration with single and multi plane lensing and an arbitrary superpositions of lens models. There is a wide range of lens models available. For details we refer to to the online-documentation.</p>
<section id="single-plane-lensing">
<h3>Single plane lensing<a class="headerlink" href="#single-plane-lensing" title="Link to this heading">#</a></h3>
<p>As an example of initializing a single plane lens model as a super-position of an elliptical power-law potential and a singular isothermal sphere mass distribution and execute some basic routines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the LensModel class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LensModel.lens_model</span> <span class="kn">import</span> <span class="n">LensModel</span>

<span class="c1"># specify the choice of lens models #</span>
<span class="n">lens_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EPL&#39;</span><span class="p">,</span> <span class="s1">&#39;SHEAR&#39;</span><span class="p">]</span>

<span class="c1"># setup lens model class with the list of lens models #</span>
<span class="n">lensModel</span> <span class="o">=</span> <span class="n">LensModel</span><span class="p">(</span><span class="n">lens_model_list</span><span class="o">=</span><span class="n">lens_model_list</span><span class="p">)</span>

<span class="c1"># define parameter values of lens models #</span>
<span class="n">kwargs_spep</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">2.</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">kwargs_shear</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gamma1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">:</span> <span class="mf">.03</span><span class="p">}</span>
<span class="n">kwargs_lens</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_spep</span><span class="p">,</span> <span class="n">kwargs_shear</span><span class="p">]</span>


<span class="c1"># image plane coordinate #</span>
<span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">.5</span>

<span class="c1"># source plane coordinate #</span>
<span class="n">beta_ra</span><span class="p">,</span> <span class="n">beta_dec</span> <span class="o">=</span> <span class="n">lensModel</span><span class="o">.</span><span class="n">ray_shooting</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="p">)</span>
<span class="c1"># Fermat potential #</span>
<span class="n">fermat_pot</span> <span class="o">=</span> <span class="n">lensModel</span><span class="o">.</span><span class="n">fermat_potential</span><span class="p">(</span><span class="n">x_image</span><span class="o">=</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">y_image</span><span class="o">=</span><span class="n">theta_dec</span><span class="p">,</span> <span class="n">x_source</span><span class="o">=</span><span class="n">beta_ra</span><span class="p">,</span> <span class="n">y_source</span><span class="o">=</span><span class="n">beta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">)</span>

<span class="c1"># Magnification #</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">lensModel</span><span class="o">.</span><span class="n">magnification</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Additionally, the <span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> class allows to compute the Hessian matrix, shear and convergence, deflection angle and lensing potential. These routines are fully compatible with the numpy array structure and as a superposition of an arbitrary number of single lens models.</p>
</section>
<section id="multi-plane-lensing">
<h3>Multi-plane lensing<a class="headerlink" href="#multi-plane-lensing" title="Link to this heading">#</a></h3>
<p>The multi-plane setting of <span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> allows to place the different deflector models at different redshifts. When not further specified, the default cosmology of the <span class="math notranslate nohighlight">\(\texttt{astropy}\)</span> cosmology class. The interface to access the lensing functionalities remains the same.
In this example we add an additional Singular Isothermal Sphere (SIS) model at a different redshfit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># keep the imports and variables from above #</span>
<span class="c1"># specify redshifts of deflectors #</span>
<span class="n">redshift_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">.1</span><span class="p">]</span>
<span class="c1"># specify source redshift #</span>
<span class="n">z_source</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="c1"># setup lens model class with the list of lens models #</span>
<span class="n">lens_model_list_mp</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EPL&#39;</span><span class="p">,</span> <span class="s1">&#39;SHEAR&#39;</span><span class="p">,</span> <span class="s1">&#39;SIS&#39;</span><span class="p">]</span>
<span class="n">lensModel_mp</span> <span class="o">=</span> <span class="n">LensModel</span><span class="p">(</span><span class="n">lens_model_list</span><span class="o">=</span><span class="n">lens_model_list_mp</span><span class="p">,</span> <span class="n">z_source</span><span class="o">=</span><span class="n">z_source</span><span class="p">,</span> <span class="n">lens_redshift_list</span><span class="o">=</span><span class="n">redshift_list</span><span class="p">,</span> <span class="n">multi_plane</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">kwargs_sis</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">}</span>
<span class="n">kwargs_lens_mp</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_spep</span><span class="p">,</span> <span class="n">kwargs_shear</span><span class="p">,</span> <span class="n">kwargs_sis</span><span class="p">]</span>

<span class="c1"># source plane coordinate #</span>
<span class="n">beta_ra</span><span class="p">,</span> <span class="n">beta_dec</span> <span class="o">=</span> <span class="n">lensModel_mp</span><span class="o">.</span><span class="n">ray_shooting</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens_mp</span><span class="p">)</span>

<span class="c1"># Magnification #</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">lensModel_mp</span><span class="o">.</span><span class="n">magnification</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens_mp</span><span class="p">)</span>

<span class="c1"># arrival time relative to a straight path through (0,0) #</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">lensModel_mp</span><span class="o">.</span><span class="n">arrival_time</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens_mp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lens-equation-solver">
<h3>lens equation solver<a class="headerlink" href="#lens-equation-solver" title="Link to this heading">#</a></h3>
<p>Solving the lens equation to compute the (multiple) image positions of a given source position can be conveniently performed within <span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> and is supported with a general instance of the <span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># keep the imports and variables from above #</span>
<span class="c1"># import the lens equation solver class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LensModel.Solver.lens_equation_solver</span> <span class="kn">import</span> <span class="n">LensEquationSolver</span>

<span class="c1"># specifiy the lens model class to deal with #</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">LensEquationSolver</span><span class="p">(</span><span class="n">lensModel</span><span class="p">)</span>

<span class="c1"># solve for image positions provided a lens model and the source position #</span>
<span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">image_position_from_source</span><span class="p">(</span><span class="n">beta_ra</span><span class="p">,</span> <span class="n">beta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="p">)</span>

<span class="c1"># the magnification of the point source images #</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">lensModel</span><span class="o">.</span><span class="n">magnification</span><span class="p">(</span><span class="n">theta_ra</span><span class="p">,</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="illustration-of-lens-models">
<h3>illustration of lens models<a class="headerlink" href="#illustration-of-lens-models" title="Link to this heading">#</a></h3>
<p>The lens models can be conveniently illustrated with routines present in the <span class="math notranslate nohighlight">\(\texttt{Plot}\)</span> module. As an option, you can plot the critical curves and caustics, which are computationally the most demanding part.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lenstronomy.Plots</span> <span class="kn">import</span> <span class="n">lens_plot</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axex</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lens_plot</span><span class="o">.</span><span class="n">lens_model_plot</span><span class="p">(</span><span class="n">axex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lensModel</span><span class="o">=</span><span class="n">lensModel</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">sourcePos_x</span><span class="o">=</span><span class="n">beta_ra</span><span class="p">,</span> <span class="n">sourcePos_y</span><span class="o">=</span><span class="n">beta_dec</span><span class="p">,</span> <span class="n">point_source</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_caustics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast_caustic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coord_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lens_plot</span><span class="o">.</span><span class="n">lens_model_plot</span><span class="p">(</span><span class="n">axex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lensModel</span><span class="o">=</span><span class="n">lensModel_mp</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens_mp</span><span class="p">,</span> <span class="n">sourcePos_x</span><span class="o">=</span><span class="n">beta_ra</span><span class="p">,</span> <span class="n">sourcePos_y</span><span class="o">=</span><span class="n">beta_dec</span><span class="p">,</span> <span class="n">point_source</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_caustics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast_caustic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coord_inverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/yp/rr1r4kgd2f3fpggf8vqnkqym0000gn/T/ipykernel_55411/3807885781.py:5: UserWarning: Matplotlib is currently using module://matplotlib_inline.backend_inline, which is a non-GUI backend, so cannot show the figure.
  f.show()
</pre></div>
</div>
<img alt="_images/e86e012f42209ad38d08f0a2ea434eb80330e2134412da643c50b2340f87f901.png" src="_images/e86e012f42209ad38d08f0a2ea434eb80330e2134412da643c50b2340f87f901.png" />
</div>
</div>
</section>
</section>
<section id="texttt-lightmodel-module">
<h2><span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> module<a class="headerlink" href="#texttt-lightmodel-module" title="Link to this heading">#</a></h2>
<p>The <span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> class provides the functionality to describe galaxy surface brightnesses. <span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> supports various analytic profiles as well as representations in shapelet basis sets. Any superposition of different profiles is allowed.</p>
<p>The parameter levelig the amplitude of the surface brightness of a certain profile is named ‘amp’. The units are not further specified and are effectively reflecting a surface brightness quantitiy integrated over the unit of angle square. In the <span class="math notranslate nohighlight">\(\texttt{SimulationAPI}\)</span> module, the user can conveniently chose astronomical magnitudes as inputs to the profiles, provided the magnitude zero point is declared. Have a look at the specific notebook to see a demonstration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the LightModel class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.LightModel.light_model</span> <span class="kn">import</span> <span class="n">LightModel</span>
<span class="c1"># set up the list of light models to be used #</span>
<span class="n">source_light_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SERSIC&#39;</span><span class="p">]</span>
<span class="n">lightModel_source</span> <span class="o">=</span> <span class="n">LightModel</span><span class="p">(</span><span class="n">light_model_list</span><span class="o">=</span><span class="n">source_light_model_list</span><span class="p">)</span>
<span class="n">lens_light_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SERSIC_ELLIPSE&#39;</span><span class="p">]</span>
<span class="n">lightModel_lens</span> <span class="o">=</span> <span class="n">LightModel</span><span class="p">(</span><span class="n">light_model_list</span><span class="o">=</span><span class="n">lens_light_model_list</span><span class="p">)</span>
<span class="c1"># define the parameters #</span>
<span class="n">kwargs_light_source</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;amp&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="n">beta_ra</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="n">beta_dec</span><span class="p">}]</span>
<span class="kn">import</span> <span class="nn">lenstronomy.Util.param_util</span> <span class="k">as</span> <span class="nn">param_util</span>
<span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">param_util</span><span class="o">.</span><span class="n">phi_q2_ellipticity</span><span class="p">(</span><span class="n">phi</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">kwargs_light_lens</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;amp&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="n">e1</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="n">e2</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>

<span class="c1"># evaluate surface brightness at a specific position #</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">lightModel_lens</span><span class="o">.</span><span class="n">surface_brightness</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kwargs_list</span><span class="o">=</span><span class="n">kwargs_light_lens</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="texttt-pointsource-module">
<h2><span class="math notranslate nohighlight">\(\texttt{PointSource}\)</span> module<a class="headerlink" href="#texttt-pointsource-module" title="Link to this heading">#</a></h2>
<p>To accurately predict and model the positon and flux of point sources, one has to apply different numerical procedures than for extended surface brightness features. The <span class="math notranslate nohighlight">\(\texttt{PointSource}\)</span> class manages the different options in describing point sources (e.g. in the image plane or source plane, with fixed magnification or allowed with individual variations thereof) and provides a homogeneous interface to access image positions and magnifications.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the PointSource class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.PointSource.point_source</span> <span class="kn">import</span> <span class="n">PointSource</span>

<span class="c1"># unlensed source positon #</span>
<span class="n">point_source_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SOURCE_POSITION&#39;</span><span class="p">]</span>
<span class="n">pointSource</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="n">point_source_type_list</span><span class="o">=</span><span class="n">point_source_model_list</span><span class="p">,</span> <span class="n">lens_model</span><span class="o">=</span><span class="n">lensModel</span><span class="p">,</span> <span class="n">fixed_magnification_list</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span>
<span class="n">kwargs_ps</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;ra_source&#39;</span><span class="p">:</span> <span class="n">beta_ra</span><span class="p">,</span> <span class="s1">&#39;dec_source&#39;</span><span class="p">:</span> <span class="n">beta_dec</span><span class="p">,</span> <span class="s1">&#39;source_amp&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}]</span>
<span class="c1"># return image positions and amplitudes #</span>
<span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">pointSource</span><span class="o">.</span><span class="n">image_position</span><span class="p">(</span><span class="n">kwargs_ps</span><span class="o">=</span><span class="n">kwargs_ps</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">)</span>
<span class="n">point_amp</span> <span class="o">=</span> <span class="n">pointSource</span><span class="o">.</span><span class="n">image_amplitude</span><span class="p">(</span><span class="n">kwargs_ps</span><span class="o">=</span><span class="n">kwargs_ps</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">)</span>

<span class="c1"># lensed image positions (solution of the lens equation) #</span>
<span class="n">point_source_model_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LENSED_POSITION&#39;</span><span class="p">]</span>
<span class="n">pointSource</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="n">point_source_type_list</span><span class="o">=</span><span class="n">point_source_model_list</span><span class="p">,</span> <span class="n">lens_model</span><span class="o">=</span><span class="n">lensModel</span><span class="p">,</span> <span class="n">fixed_magnification_list</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span>
<span class="n">kwargs_ps</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;ra_image&#39;</span><span class="p">:</span> <span class="n">theta_ra</span><span class="p">,</span> <span class="s1">&#39;dec_image&#39;</span><span class="p">:</span> <span class="n">theta_dec</span><span class="p">,</span> <span class="s1">&#39;point_amp&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span><span class="o">*</span><span class="mi">30</span><span class="p">}]</span>
<span class="c1"># return image positions and amplitudes #</span>
<span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">pointSource</span><span class="o">.</span><span class="n">image_position</span><span class="p">(</span><span class="n">kwargs_ps</span><span class="o">=</span><span class="n">kwargs_ps</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">)</span>
<span class="n">point_amp</span> <span class="o">=</span> <span class="n">pointSource</span><span class="o">.</span><span class="n">image_amplitude</span><span class="p">(</span><span class="n">kwargs_ps</span><span class="o">=</span><span class="n">kwargs_ps</span><span class="p">,</span> <span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="texttt-data-module">
<h2><span class="math notranslate nohighlight">\(\texttt{Data}\)</span> module<a class="headerlink" href="#texttt-data-module" title="Link to this heading">#</a></h2>
<p>The <span class="math notranslate nohighlight">\(\texttt{PixelGrid}\)</span> class stores and manages the coordinate frame and. the coordinate-to-pixel transformation necessary to simulate images.
The <span class="math notranslate nohighlight">\(\texttt{PSF}\)</span> class handles the point spread function convolution. Supported are pixelized convolution kernels as well as some analytic profiles.</p>
<p>The <span class="math notranslate nohighlight">\(\texttt{Data}\)</span> class inherits the <span class="math notranslate nohighlight">\(\texttt{PixelGrid}\)</span> and in addition manages data specific quantities (pixel values and noise properties) that are required when fitting models to data to estimate the likelihood of the data given a model. To simulate a mock lens, we only require an instance of the <span class="math notranslate nohighlight">\(\texttt{PixelGrid}\)</span> and <span class="math notranslate nohighlight">\(\texttt{PSF}\)</span> class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the PixelGrid() class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Data.pixel_grid</span> <span class="kn">import</span> <span class="n">PixelGrid</span>
<span class="n">deltaPix</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># size of pixel in angular coordinates #</span>

<span class="c1"># setup the keyword arguments to create the Data() class #</span>
<span class="n">ra_at_xy_0</span><span class="p">,</span> <span class="n">dec_at_xy_0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span> <span class="c1"># coordinate in angles (RA/DEC) at the position of the pixel edge (0,0)</span>
<span class="n">transform_pix2angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">deltaPix</span>  <span class="c1"># linear translation matrix of a shift in pixel in a shift in coordinates</span>
<span class="n">kwargs_pixel</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nx&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;ny&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>  <span class="c1"># number of pixels per axis</span>
                <span class="s1">&#39;ra_at_xy_0&#39;</span><span class="p">:</span> <span class="n">ra_at_xy_0</span><span class="p">,</span>  <span class="c1"># RA at pixel (0,0)</span>
                <span class="s1">&#39;dec_at_xy_0&#39;</span><span class="p">:</span> <span class="n">dec_at_xy_0</span><span class="p">,</span>  <span class="c1"># DEC at pixel (0,0)</span>
                <span class="s1">&#39;transform_pix2angle&#39;</span><span class="p">:</span> <span class="n">transform_pix2angle</span><span class="p">}</span> 
<span class="n">pixel_grid</span> <span class="o">=</span> <span class="n">PixelGrid</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_pixel</span><span class="p">)</span>
<span class="c1"># return the list of pixel coordinates #</span>
<span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span> <span class="o">=</span> <span class="n">pixel_grid</span><span class="o">.</span><span class="n">pixel_coordinates</span>
<span class="c1"># compute pixel value of a coordinate position #</span>
<span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">pixel_grid</span><span class="o">.</span><span class="n">map_coord2pix</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># compute the coordinate value of a pixel position #</span>
<span class="n">ra_pos</span><span class="p">,</span> <span class="n">dec_pos</span> <span class="o">=</span> <span class="n">pixel_grid</span><span class="o">.</span><span class="n">map_pix2coord</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># import the PSF() class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Data.psf</span> <span class="kn">import</span> <span class="n">PSF</span>
<span class="n">kwargs_psf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;psf_type&#39;</span><span class="p">:</span> <span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">,</span>  <span class="c1"># type of PSF model (supports &#39;GAUSSIAN&#39; and &#39;PIXEL&#39;)</span>
              <span class="s1">&#39;fwhm&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># full width at half maximum of the Gaussian PSF (in angular units)</span>
              <span class="s1">&#39;pixel_size&#39;</span><span class="p">:</span> <span class="n">deltaPix</span>  <span class="c1"># angular scale of a pixel (required for a Gaussian PSF to translate the FWHM into a pixel scale)</span>
             <span class="p">}</span>
<span class="n">psf</span> <span class="o">=</span> <span class="n">PSF</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_psf</span><span class="p">)</span>
<span class="c1"># return the pixel kernel corresponding to a point source # </span>
<span class="n">kernel</span> <span class="o">=</span> <span class="n">psf</span><span class="o">.</span><span class="n">kernel_point_source</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="texttt-imsim-module">
<h2><span class="math notranslate nohighlight">\(\texttt{ImSim}\)</span> module<a class="headerlink" href="#texttt-imsim-module" title="Link to this heading">#</a></h2>
<p>The <span class="math notranslate nohighlight">\(\texttt{ImSim}\)</span> module simulates images. At its core is the <span class="math notranslate nohighlight">\(\texttt{ImageModel}\)</span> class. It is the interface to combine all the different components, <span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span>, <span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span>, <span class="math notranslate nohighlight">\(\texttt{PointSource}\)</span> and <span class="math notranslate nohighlight">\(\texttt{Data}\)</span> to model images. The <span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> can be used to model lens light (unlensed) or source light (lensed). <span class="math notranslate nohighlight">\(\texttt{ImSim}\)</span> is fully supporting all functionalities in each component. Additionaly, numerical precision arguments can be set in how to model the image.</p>
<section id="simulate-image">
<h3>Simulate image<a class="headerlink" href="#simulate-image" title="Link to this heading">#</a></h3>
<p>We simulate an image with an instance of <span class="math notranslate nohighlight">\(\texttt{ImageModel}\)</span> that got instances of the classes we created above. We can define two different <span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> instances for the lens and source light. Additionally, we can define the sub-pixel ray-tracing resolution and whether the PSF convolution is applied on the higher resolution ray-tracing image or on the degraded pixel image.</p>
<p>In this example, we do not simulate point source. You can look at the notebooks dedicated to model quads and doubles and also for time-delya cosmography.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the ImageModel class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.ImSim.image_model</span> <span class="kn">import</span> <span class="n">ImageModel</span>
<span class="c1"># define the numerics #</span>
<span class="n">kwargs_numerics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;supersampling_factor&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># each pixel gets super-sampled (in each axis direction) </span>
                  <span class="s1">&#39;supersampling_convolution&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="c1"># initialize the Image model class by combining the modules we created above #</span>
<span class="n">imageModel</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">data_class</span><span class="o">=</span><span class="n">pixel_grid</span><span class="p">,</span> <span class="n">psf_class</span><span class="o">=</span><span class="n">psf</span><span class="p">,</span> <span class="n">lens_model_class</span><span class="o">=</span><span class="n">lensModel</span><span class="p">,</span>
                        <span class="n">source_model_class</span><span class="o">=</span><span class="n">lightModel_source</span><span class="p">,</span>
                        <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel_lens</span><span class="p">,</span>
                        <span class="n">point_source_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># in this example, we do not simulate point source.</span>
                        <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics</span><span class="p">)</span>
<span class="c1"># simulate image with the parameters we have defined above #</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">imageModel</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">kwargs_source</span><span class="o">=</span><span class="n">kwargs_light_source</span><span class="p">,</span>
                         <span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light_lens</span><span class="p">,</span> <span class="n">kwargs_ps</span><span class="o">=</span><span class="n">kwargs_ps</span><span class="p">)</span>

<span class="c1"># we can also add noise #</span>
<span class="kn">import</span> <span class="nn">lenstronomy.Util.image_util</span> <span class="k">as</span> <span class="nn">image_util</span>
<span class="n">exp_time</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># exposure time to quantify the Poisson noise level</span>
<span class="n">background_rms</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># background rms value</span>
<span class="n">poisson</span> <span class="o">=</span> <span class="n">image_util</span><span class="o">.</span><span class="n">add_poisson</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">exp_time</span><span class="o">=</span><span class="n">exp_time</span><span class="p">)</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">image_util</span><span class="o">.</span><span class="n">add_background</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sigma_bkd</span><span class="o">=</span><span class="n">background_rms</span><span class="p">)</span>
<span class="n">image_noisy</span> <span class="o">=</span> <span class="n">image</span> <span class="o">+</span> <span class="n">bkg</span> <span class="o">+</span> <span class="n">poisson</span>

<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">image_noisy</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/yp/rr1r4kgd2f3fpggf8vqnkqym0000gn/T/ipykernel_55411/2212537119.py:26: RuntimeWarning: invalid value encountered in log10
  axes[1].matshow(np.log10(image_noisy), origin=&#39;lower&#39;)
</pre></div>
</div>
<img alt="_images/ed1fd1aaca4a2ad603e78f854f0a70562fcb0fc68bedbd0d80bfe387d32a26d2.png" src="_images/ed1fd1aaca4a2ad603e78f854f0a70562fcb0fc68bedbd0d80bfe387d32a26d2.png" />
</div>
</div>
</section>
<section id="linear-inversion">
<h3>Linear inversion<a class="headerlink" href="#linear-inversion" title="Link to this heading">#</a></h3>
<p>Parameter corresponding to an an amplitude of a surface brightness distribution have a linear response on the predicted flux values in the data and can be infered by a linear inversion. This can reduce the number of non-linear parameters fastly, depending on the source complexity to be modelled.</p>
<p>The <span class="math notranslate nohighlight">\(\texttt{ImageLinearFit}\)</span> class performs this computation. The class inherits the <span class="math notranslate nohighlight">\(\texttt{ImageModel}\)</span> class but instead of the <span class="math notranslate nohighlight">\(\texttt{PixelGrid}\)</span> instance, it requires an instance of the full <span class="math notranslate nohighlight">\(\texttt{ImageData}\)</span> class including the data (which we use the mock image created above) and the noise properties therof.</p>
<p>In the example of this notebook, we have 6 linear parameters, the 4 point source amplitudes and the amplitudes of the Sersic profile of the lens and source. <em>lenstronomy</em> automatically identifies those parameters and can recover those values (data permitting).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lenstronomy.Data.imaging_data</span> <span class="kn">import</span> <span class="n">ImageData</span>
<span class="c1"># update the data with the noisy image and its noise properties #</span>
<span class="n">kwargs_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;image_data&#39;</span><span class="p">:</span> <span class="n">image_noisy</span><span class="p">,</span>
               <span class="s1">&#39;background_rms&#39;</span><span class="p">:</span> <span class="n">background_rms</span><span class="p">,</span>
               <span class="s1">&#39;exposure_time&#39;</span><span class="p">:</span> <span class="n">exp_time</span><span class="p">,</span>
               <span class="s1">&#39;ra_at_xy_0&#39;</span><span class="p">:</span> <span class="n">ra_at_xy_0</span><span class="p">,</span>  
               <span class="s1">&#39;dec_at_xy_0&#39;</span><span class="p">:</span> <span class="n">dec_at_xy_0</span><span class="p">,</span>
               <span class="s1">&#39;transform_pix2angle&#39;</span><span class="p">:</span> <span class="n">transform_pix2angle</span><span class="p">}</span> 

<span class="n">data_class</span> <span class="o">=</span> <span class="n">ImageData</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs_data</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">lenstronomy.ImSim.image_linear_solve</span> <span class="kn">import</span> <span class="n">ImageLinearFit</span>
<span class="n">image_linear_fit</span> <span class="o">=</span> <span class="n">ImageLinearFit</span><span class="p">(</span><span class="n">data_class</span><span class="o">=</span><span class="n">data_class</span><span class="p">,</span> <span class="n">psf_class</span><span class="o">=</span><span class="n">psf</span><span class="p">,</span> <span class="n">lens_model_class</span><span class="o">=</span><span class="n">lensModel</span><span class="p">,</span>
                        <span class="n">source_model_class</span><span class="o">=</span><span class="n">lightModel_source</span><span class="p">,</span>
                        <span class="n">lens_light_model_class</span><span class="o">=</span><span class="n">lightModel_lens</span><span class="p">,</span>
                        <span class="n">point_source_class</span><span class="o">=</span><span class="n">pointSource</span><span class="p">,</span> 
                        <span class="n">kwargs_numerics</span><span class="o">=</span><span class="n">kwargs_numerics</span><span class="p">)</span>

<span class="c1"># we do not require the knowledge of the linear parameters #</span>
<span class="k">del</span> <span class="n">kwargs_light_source</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span>
<span class="c1"># apply the linear inversion to fit for the noisy image #</span>
<span class="n">image_reconstructed</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">image_linear_fit</span><span class="o">.</span><span class="n">image_linear_solve</span><span class="p">(</span><span class="n">kwargs_lens</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">kwargs_source</span><span class="o">=</span><span class="n">kwargs_light_source</span><span class="p">,</span> 
                              <span class="n">kwargs_lens_light</span><span class="o">=</span><span class="n">kwargs_light_lens</span><span class="p">,</span> <span class="n">kwargs_ps</span><span class="o">=</span><span class="n">kwargs_ps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># illustrate fit #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Plots.model_plot</span> <span class="kn">import</span> <span class="n">ModelPlot</span>
<span class="n">kwargs_model</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lens_model_list&#39;</span><span class="p">:</span> <span class="n">lens_model_list</span><span class="p">,</span> <span class="s1">&#39;source_light_model_list&#39;</span><span class="p">:</span> <span class="n">source_light_model_list</span><span class="p">,</span>
               <span class="s1">&#39;lens_light_model_list&#39;</span><span class="p">:</span> <span class="n">lens_light_model_list</span><span class="p">}</span> <span class="c1">#, &#39;point_source_model_list&#39;: point_source_model_list}</span>
<span class="n">kwargs_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kwargs_lens&#39;</span><span class="p">:</span> <span class="n">kwargs_lens</span><span class="p">,</span> <span class="s1">&#39;kwargs_source&#39;</span><span class="p">:</span> <span class="n">kwargs_light_source</span><span class="p">,</span>
                 <span class="s1">&#39;kwargs_lens_light&#39;</span><span class="p">:</span> <span class="n">kwargs_light_lens</span><span class="p">,</span> <span class="s1">&#39;kwargs_ps&#39;</span><span class="p">:</span> <span class="n">kwargs_ps</span><span class="p">}</span>
<span class="n">lensPlot</span> <span class="o">=</span> <span class="n">ModelPlot</span><span class="p">([[</span><span class="n">kwargs_data</span><span class="p">,</span> <span class="n">kwargs_psf</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="p">]],</span> <span class="n">kwargs_model</span><span class="p">,</span> <span class="n">kwargs_params</span><span class="p">,</span> <span class="n">arrow_size</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lensPlot</span><span class="o">.</span><span class="n">data_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">lensPlot</span><span class="o">.</span><span class="n">model_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.9880423794650953 reduced X^2 of all evaluated imaging data combined (without degrees of freedom subtracted).
reduced chi^2 of data  0 =  0.9880423794650953
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/sibirrer/Software/lenstronomy/lenstronomy/Plots/plot_util.py:352: MatplotlibDeprecationWarning: You are modifying the state of a globally registered colormap. This has been deprecated since 3.3 and in 3.6, you will not be able to modify a registered colormap in-place. To remove this warning, you can make a copy of the colormap first. cmap = mpl.cm.get_cmap(&quot;gist_heat&quot;).copy()
  cmap_new.set_bad(color=&quot;k&quot;, alpha=1.0)
/Users/sibirrer/Software/lenstronomy/lenstronomy/Plots/plot_util.py:353: MatplotlibDeprecationWarning: You are modifying the state of a globally registered colormap. This has been deprecated since 3.3 and in 3.6, you will not be able to modify a registered colormap in-place. To remove this warning, you can make a copy of the colormap first. cmap = mpl.cm.get_cmap(&quot;gist_heat&quot;).copy()
  cmap_new.set_under(&quot;k&quot;)
/Users/sibirrer/Software/lenstronomy/lenstronomy/Plots/model_band_plot.py:160: RuntimeWarning: invalid value encountered in log10
  np.log10(self._data),
</pre></div>
</div>
<img alt="_images/ce69f32ba7c4e1648569cf30e8ff86d4cb58e7bc780583929bf97847fb17bec9.png" src="_images/ce69f32ba7c4e1648569cf30e8ff86d4cb58e7bc780583929bf97847fb17bec9.png" />
</div>
</div>
</section>
</section>
<section id="texttt-sampling-module">
<h2><span class="math notranslate nohighlight">\(\texttt{Sampling}\)</span> Module<a class="headerlink" href="#texttt-sampling-module" title="Link to this heading">#</a></h2>
<p>The <span class="math notranslate nohighlight">\(\texttt{Sampling}\)</span> Module consists of threee major classes: The <span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class manages the specific likelihood function, consisting of the imaging likelihood and potential other data and constraints. The <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class handles all the model choices and the parameters going in it. These classes handle all the model choices of the user and mitigate them to the external modules and from the external modules back to <em>lenstronomy</em>.</p>
<p>The <span class="math notranslate nohighlight">\(\texttt{Sampler}\)</span> class gives specific examples how the <span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> and <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> classes can be used to execute specific samplers. This last class can also be replaced by other sampling methods by the user.</p>
<section id="texttt-param-class">
<h3><span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class<a class="headerlink" href="#texttt-param-class" title="Link to this heading">#</a></h3>
<p>The <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class is the interface of the <em>lenstronomy</em> conventions of parameters (list of keyword arguments) and the fitting conventions of <span class="math notranslate nohighlight">\(\texttt{CosmoHammer}\)</span> or <span class="math notranslate nohighlight">\(\texttt{emcee}\)</span> (single array consisting all parameters). The <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class enables the user to set further options:</p>
<ul class="simple">
<li><p>keep certain parameters fixed</p></li>
<li><p>handling of the linear parameters</p></li>
<li><p>provide additional constraints on the modelling (e.g. fix source profile to point source position etc)</p></li>
</ul>
<p>With the <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class, lenstronomy can be integrated robustly with other sampling methods.</p>
<div class="alert alert-warning">
<p><strong>ATTENTION:</strong> lenstronomy, by default, solves for the amplitude values of surface brighthness functions (in the lens and source) specified in the model by ‘amp’ through a linear minimization at each likelihood evaluation step. Solving a linear equation is more efficient than sampling the parameters in the non-linear exploration. Hence, the output of a sampling chain (be it PSO, MCMC or any other sampler used) do not contain the linear amplitudes and are set as =0.
To retriev the linear amplitude parameters, you have to re-do the linear inversion in post processing. This can be done with the <span class="math notranslate nohighlight">\(\texttt{LensModelPlot}\)</span> class (see block further down) or with the <span class="math notranslate nohighlight">\(\texttt{ImageReconstruction}\)</span> class in the <span class="math notranslate nohighlight">\(\texttt{Analysis}\)</span> sub-package.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the parameter handling class #</span>
<span class="kn">from</span> <span class="nn">lenstronomy.Sampling.parameters</span> <span class="kn">import</span> <span class="n">Param</span>
<span class="c1"># set options for constraint parameters #</span>
<span class="c1"># Here we join the position of the lens light and mass center. </span>
<span class="c1"># There are more options available in the Param() class.</span>
<span class="n">kwargs_constraints</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;joint_lens_with_light&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;center_x&#39;</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">]]]}</span>

<span class="c1"># list fixed parameters #</span>
<span class="n">kwargs_fixed_lens</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">2.</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;ra_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;dec_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{}]</span>
<span class="n">kwargs_fixed_source</span> <span class="o">=</span> <span class="p">[{}]</span>
<span class="n">kwargs_fixed_lens_light</span> <span class="o">=</span> <span class="p">[{}]</span>

<span class="c1"># optional: list lower and upper bounds in parameter space, otherwise it will be using lenstronomy default values! #</span>
<span class="c1"># list lower bounds in parameter space #</span>
<span class="n">kwargs_lower_lens</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">},</span>
                     <span class="p">{</span><span class="s1">&#39;gamma1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">}]</span>
<span class="n">kwargs_lower_source</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">}]</span>
<span class="n">kwargs_lower_lens_light</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">}]</span>
<span class="n">kwargs_lower_ps</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># list upper bounds in parameter space #</span>
<span class="n">kwargs_upper_lens</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">10.</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
                     <span class="p">{</span><span class="s1">&#39;gamma1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}]</span>
<span class="n">kwargs_upper_source</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">5.</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}]</span>
<span class="n">kwargs_upper_lens_light</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">5.</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}]</span>
<span class="n">kwargs_upper_ps</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># make instance of parameter class with given model options, constraints and fixed parameters #</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">kwargs_model</span><span class="p">,</span> <span class="n">kwargs_fixed_lens</span><span class="p">,</span> <span class="n">kwargs_fixed_source</span><span class="p">,</span>
              <span class="n">kwargs_fixed_lens_light</span><span class="p">,</span> <span class="n">kwargs_fixed_ps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
              <span class="n">kwargs_lower_lens</span><span class="o">=</span><span class="n">kwargs_lower_lens</span><span class="p">,</span> <span class="n">kwargs_lower_source</span><span class="o">=</span><span class="n">kwargs_lower_source</span><span class="p">,</span>
              <span class="n">kwargs_lower_lens_light</span><span class="o">=</span><span class="n">kwargs_lower_lens_light</span><span class="p">,</span> <span class="n">kwargs_lower_ps</span><span class="o">=</span><span class="n">kwargs_lower_ps</span><span class="p">,</span>
              <span class="n">kwargs_upper_lens</span><span class="o">=</span><span class="n">kwargs_upper_lens</span><span class="p">,</span> <span class="n">kwargs_upper_source</span><span class="o">=</span><span class="n">kwargs_upper_source</span><span class="p">,</span>
              <span class="n">kwargs_upper_lens_light</span><span class="o">=</span><span class="n">kwargs_upper_lens_light</span><span class="p">,</span> <span class="n">kwargs_upper_ps</span><span class="o">=</span><span class="n">kwargs_upper_ps</span><span class="p">,</span>
              <span class="n">kwargs_lens_init</span><span class="o">=</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_constraints</span><span class="p">)</span>

<span class="c1"># the number of non-linear parameters and their names #</span>
<span class="n">num_param</span><span class="p">,</span> <span class="n">param_list</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">num_param</span><span class="p">()</span>

<span class="c1"># parameter array for fitting routine #</span>
<span class="n">param_array</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">kwargs2args</span><span class="p">(</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">kwargs_light_source</span><span class="p">,</span> <span class="n">kwargs_light_lens</span><span class="p">,</span> <span class="n">kwargs_ps</span><span class="p">)</span>

<span class="c1"># recover keyword arguments list for lenstronomy from a parameter array of the fitting routine #</span>
<span class="n">kwargs_out</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">args2kwargs</span><span class="p">(</span><span class="n">param_array</span><span class="p">)</span>

<span class="c1"># print settings #</span>
<span class="n">param</span><span class="o">.</span><span class="n">print_setting</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following model options are chosen:
Lens models: [&#39;EPL&#39;, &#39;SHEAR&#39;]
Source models: [&#39;SERSIC&#39;]
Lens light models: [&#39;SERSIC_ELLIPSE&#39;]
Point source models: []
===================
The following parameters are being fixed:
Lens: [{&#39;gamma&#39;: 2.0, &#39;center_x&#39;: 0, &#39;center_y&#39;: 0}, {&#39;ra_0&#39;: 0, &#39;dec_0&#39;: 0}, {}]
Source: [{&#39;amp&#39;: 1}]
Lens light: [{&#39;amp&#39;: 1}]
Point source: []
Tracer Source: []
===================
Joint parameters for different models
Joint lens with lens: []
Joint lens light with lens light: []
Joint source with source: []
Joint lens with light: [[0, 0, [&#39;center_x&#39;, &#39;center_y&#39;]]]
Joint source with point source: []
Joint lens light with point source: []
Joint source light with tracer source: []
Mass scaling: 0 groups
General lens scaling: {}
===================
Number of non-linear parameters being sampled:  15
Parameters being sampled:  [&#39;theta_E_lens0&#39;, &#39;e1_lens0&#39;, &#39;e2_lens0&#39;, &#39;gamma1_lens1&#39;, &#39;gamma2_lens1&#39;, &#39;R_sersic_source_light0&#39;, &#39;n_sersic_source_light0&#39;, &#39;center_x_source_light0&#39;, &#39;center_y_source_light0&#39;, &#39;R_sersic_lens_light0&#39;, &#39;n_sersic_lens_light0&#39;, &#39;e1_lens_light0&#39;, &#39;e2_lens_light0&#39;, &#39;center_x_lens_light0&#39;, &#39;center_y_lens_light0&#39;]
Number of linear parameters being solved for:  2
===================
The log10 of following parameters is being sampled:
Lens: [[], []]
</pre></div>
</div>
</div>
</div>
</section>
<section id="texttt-likelihood-class">
<h3><span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class<a class="headerlink" href="#texttt-likelihood-class" title="Link to this heading">#</a></h3>
<p>The <span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class performs the likelihood computation. It combines the <span class="math notranslate nohighlight">\(\texttt{ImSim}\)</span> module with the <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> module. The <span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class can evaluate imaging likelihoods, image position and time-delay likelihood with various options. For details we refer to the class documentation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kwargs_likelihood</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;source_marg&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s1">&#39;check_matched_source_position&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;source_position_tolerance&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,}</span>
<span class="n">single_band</span> <span class="o">=</span> <span class="p">[[</span><span class="n">kwargs_data</span><span class="p">,</span> <span class="n">kwargs_psf</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="p">]]</span>
<span class="n">kwargs_data_joint</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;multi_band_list&#39;</span><span class="p">:</span> <span class="n">single_band</span><span class="p">,</span> <span class="s1">&#39;multi_band_type&#39;</span><span class="p">:</span> <span class="s1">&#39;multi-linear&#39;</span><span class="p">}</span>

<span class="kn">from</span> <span class="nn">lenstronomy.Sampling.likelihood</span> <span class="kn">import</span> <span class="n">LikelihoodModule</span>
<span class="n">likelihoodModule</span> <span class="o">=</span> <span class="n">LikelihoodModule</span><span class="p">(</span><span class="n">kwargs_data_joint</span><span class="p">,</span> <span class="n">kwargs_model</span><span class="p">,</span> <span class="n">param_class</span><span class="o">=</span><span class="n">param</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_likelihood</span><span class="p">)</span>

<span class="n">logL</span> <span class="o">=</span> <span class="n">likelihoodModule</span><span class="o">.</span><span class="n">logL</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">param_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="texttt-sampler-class">
<h3><span class="math notranslate nohighlight">\(\texttt{Sampler}\)</span> class<a class="headerlink" href="#texttt-sampler-class" title="Link to this heading">#</a></h3>
<p>The <span class="math notranslate nohighlight">\(\texttt{Sampler}\)</span> class performs the sampling of the likelihood. The class requires an instance of the <span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class. This class is also meant to showcase the sampling of the <em>lenstronomy</em> likelihood. We emphasise that the specific parameter space and complexity may warry significantly and depending on the problem, different approaches can be more efficient.</p>
<div class="alert alert-warning">
<p><strong>Warning:</strong> This particular example was run with a very small and insufficiently long Particle Swarm Optimization. This is for illustrative purpose only. You need to change the ‘n_particles’ and ‘n_iterations’ settings and make sure the PSO is sufficiently converged to draw conclusions from the best fit.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initial guess of non-linear parameters, we chose different starting parameters than the truth #</span>
<span class="n">kwargs_lens_init</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">2.</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                    <span class="p">{</span><span class="s1">&#39;gamma1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
<span class="n">kwargs_source_init</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>
<span class="n">kwargs_lens_light_init</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]</span>

<span class="c1"># initial spread in parameter estimation #</span>
<span class="n">kwargs_lens_sigma</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;theta_E&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">.2</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
                     <span class="p">{</span><span class="s1">&#39;gamma1&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}]</span>
<span class="n">kwargs_source_sigma</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">.1</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}]</span>
<span class="n">kwargs_lens_light_sigma</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;R_sersic&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;n_sersic&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;e1&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;e2&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;center_x&#39;</span><span class="p">:</span> <span class="mf">.1</span><span class="p">,</span> <span class="s1">&#39;center_y&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}]</span>

<span class="n">param_init</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">kwargs2args</span><span class="p">(</span><span class="n">kwargs_lens_init</span><span class="p">,</span> <span class="n">kwargs_source_init</span><span class="p">,</span> <span class="n">kwargs_lens_light_init</span><span class="p">,</span> <span class="n">kwargs_ps</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">param_sigma</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">kwargs2args</span><span class="p">(</span><span class="n">kwargs_lens_sigma</span><span class="p">,</span> <span class="n">kwargs_source_sigma</span><span class="p">,</span> <span class="n">kwargs_lens_light_sigma</span><span class="p">,</span> <span class="n">kwargs_ps</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">upper_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param_init</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param_sigma</span><span class="p">)</span>
<span class="n">lower_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param_init</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param_sigma</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">lenstronomy.Sampling.sampler</span> <span class="kn">import</span> <span class="n">Sampler</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">Sampler</span><span class="p">(</span><span class="n">likelihoodModule</span><span class="o">=</span><span class="n">likelihoodModule</span><span class="p">)</span>

<span class="n">result</span><span class="p">,</span> <span class="n">chain_properties</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">pso</span><span class="p">(</span><span class="n">n_particles</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n_iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lower_start</span><span class="o">=</span><span class="n">lower_start</span><span class="p">,</span> <span class="n">upper_start</span><span class="o">=</span><span class="n">upper_start</span><span class="p">)</span>

<span class="n">kwargs_result</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">args2kwargs</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing the PSO ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/sibirrer/Software/lenstronomy/lenstronomy/LensModel/Profiles/epl.py:297: RuntimeWarning: invalid value encountered in true_divide
  R_omega = Z * hyp2f1(1, t / 2, 2 - t / 2, -(1 - q) / (1 + q) * (Z / Z.conj()))
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
Max iteration reached! Stopping.
-2.0986001832089953 reduced X^2 of best position
-10475.1628144877 log likelihood
9983 effective number of data points
[{&#39;theta_E&#39;: 0.6558739807980154, &#39;gamma&#39;: 2.0, &#39;e1&#39;: 0.18910900770653183, &#39;e2&#39;: 0.050278013959768775, &#39;center_x&#39;: 0.08562011666328166, &#39;center_y&#39;: -0.011185878648515361}, {&#39;gamma1&#39;: -0.039026672819254135, &#39;gamma2&#39;: -0.042793657431282786, &#39;ra_0&#39;: 0, &#39;dec_0&#39;: 0}] lens result
[{&#39;amp&#39;: 1, &#39;R_sersic&#39;: 0.09650380673142887, &#39;n_sersic&#39;: 0.8352676424216752, &#39;center_x&#39;: -0.3857573797726856, &#39;center_y&#39;: 0.060777200249061726}] source result
[{&#39;amp&#39;: 1, &#39;R_sersic&#39;: 0.047990003120548394, &#39;n_sersic&#39;: 1.1670340060979718, &#39;e1&#39;: 0.08170727336266241, &#39;e2&#39;: -0.014208084256340583, &#39;center_x&#39;: 0.08562011666328166, &#39;center_y&#39;: -0.011185878648515361}] lens light result
[] point source result
[] tracer source result
{} special param result
10.192030906677246 time used for  PSO
===================
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="texttt-workflow-module">
<h2><span class="math notranslate nohighlight">\(\texttt{Workflow}\)</span> Module<a class="headerlink" href="#texttt-workflow-module" title="Link to this heading">#</a></h2>
<p>The <span class="math notranslate nohighlight">\(\texttt{Workflow}\)</span> Module manages the execution of non-linear fitter (in our case the PSO) and the parameter inference (in our case the CosmoHammer emcee). The two main classes are <span class="math notranslate nohighlight">\(\texttt{Param}\)</span> and <span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span>. These classes handle all the model choices of the user and mitigate them to the external modules and from the external modules back to <em>lenstronomy</em>.</p>
<section id="texttt-fittingsequence-class">
<h3><span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> class<a class="headerlink" href="#texttt-fittingsequence-class" title="Link to this heading">#</a></h3>
<p>The <span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> class allows to perform a PSO and/or MCMC run. The user can run a sequence of fitting routines, applied one after the other with taking the results of the previous routine as an input of the next one. The user can specify (optionaly) to keep one or multiple parameter classes (lens model, source model, lens light model and source model) fixed during the fitting process or parameter inference.</p>
<p>The user further needs to specify:</p>
<ul class="simple">
<li><p>define input guess and uncertainties and uncertainties</p></li>
<li><p>hard bounds on parameters</p></li>
<li><p>number of particles and number of iterations being performed by the PSO/MCMC</p></li>
<li><p>enables MPI run through a set of fitting sequences</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> does not rely on instances of other <em>lenstronomy</em> classes. It can be constructed from elements in the form of keyword arguments and lists thereof in the <em>lenstronomy</em> conventions. This enables a save and reliable execution of tasks within <span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> on non-local platforms, such as high performance clusters.</p>
<p>MPI mode can be set in the initialization of the <span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> class. Multi-threading can be set (if available) for each individual sequence in their keyword arguments with ‘threadCount’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for this part of the code, the emcee MCMC sampler needs to be installed</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">emcee</span>
<span class="k">except</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>emcee

<span class="n">lens_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_lens_init</span><span class="p">,</span> <span class="n">kwargs_lens_sigma</span><span class="p">,</span> <span class="n">kwargs_fixed_lens</span><span class="p">,</span> <span class="n">kwargs_lower_lens</span><span class="p">,</span> <span class="n">kwargs_upper_lens</span><span class="p">]</span>
<span class="n">source_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_source_init</span><span class="p">,</span> <span class="n">kwargs_source_sigma</span><span class="p">,</span> <span class="n">kwargs_fixed_source</span><span class="p">,</span> <span class="n">kwargs_lower_source</span><span class="p">,</span> <span class="n">kwargs_upper_source</span><span class="p">]</span>
<span class="n">lens_light_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_light_lens</span><span class="p">,</span> <span class="n">kwargs_lens_light_sigma</span><span class="p">,</span> <span class="n">kwargs_fixed_lens_light</span><span class="p">,</span> <span class="n">kwargs_lower_lens_light</span><span class="p">,</span> <span class="n">kwargs_upper_lens_light</span><span class="p">]</span>

<span class="n">kwargs_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lens_model&#39;</span><span class="p">:</span> <span class="n">lens_params</span><span class="p">,</span>
                <span class="s1">&#39;source_model&#39;</span><span class="p">:</span> <span class="n">source_params</span><span class="p">,</span>
                <span class="s1">&#39;lens_light_model&#39;</span><span class="p">:</span> <span class="n">lens_light_params</span><span class="p">}</span>

<span class="n">band_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs_data</span><span class="p">,</span> <span class="n">kwargs_psf</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="p">]</span>
<span class="n">multi_band_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">multi_band_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">band_list</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">lenstronomy.Workflow.fitting_sequence</span> <span class="kn">import</span> <span class="n">FittingSequence</span>
<span class="n">fitting_seq</span> <span class="o">=</span> <span class="n">FittingSequence</span><span class="p">(</span><span class="n">kwargs_data_joint</span><span class="p">,</span> <span class="n">kwargs_model</span><span class="p">,</span> <span class="n">kwargs_constraints</span><span class="p">,</span> <span class="n">kwargs_likelihood</span><span class="p">,</span> <span class="n">kwargs_params</span><span class="p">,</span> <span class="n">mpi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fitting_kwargs_list</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;PSO&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sigma_scale&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;n_particles&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;n_iterations&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;threadCount&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span>
                       <span class="p">[</span><span class="s1">&#39;MCMC&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;n_burn&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;n_run&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;n_walkers&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;sigma_scale&#39;</span><span class="p">:</span> <span class="mf">.01</span><span class="p">,</span> <span class="s1">&#39;threadCount&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]]</span>

<span class="n">chain_list</span> <span class="o">=</span> <span class="n">fitting_seq</span><span class="o">.</span><span class="n">fit_sequence</span><span class="p">(</span><span class="n">fitting_kwargs_list</span><span class="p">)</span>
<span class="n">kwargs_result</span> <span class="o">=</span> <span class="n">fitting_seq</span><span class="o">.</span><span class="n">best_fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing the PSO ...
10
20
30
40
50
60
70
80
90
100
110
120
130
140
150
160
170
180
190
Converged after 192 iterations!
Best fit found:  -4929.815830139583 [1.1007844223695822, 0.09488860149690072, 0.10184276619173815, -0.012974544059583997, 0.03257439563491101, 0.10285667590308133, 1.5805696311080353, 0.055382335642987314, -0.07683151666360807, 0.10108487466803297, 2.957545832249977, 0.08533573815979766, 0.1593522237750895, 0.10268173391669946, 0.0011953395711379064]
-0.9876421576959998 reduced X^2 of best position
-4929.815830139583 log likelihood
9983 effective number of data points
[{&#39;theta_E&#39;: 1.1007844223695822, &#39;gamma&#39;: 2.0, &#39;e1&#39;: 0.09488860149690072, &#39;e2&#39;: 0.10184276619173815, &#39;center_x&#39;: 0.10268173391669946, &#39;center_y&#39;: 0.0011953395711379064}, {&#39;gamma1&#39;: -0.012974544059583997, &#39;gamma2&#39;: 0.03257439563491101, &#39;ra_0&#39;: 0, &#39;dec_0&#39;: 0}] lens result
[{&#39;amp&#39;: 1, &#39;R_sersic&#39;: 0.10285667590308133, &#39;n_sersic&#39;: 1.5805696311080353, &#39;center_x&#39;: 0.055382335642987314, &#39;center_y&#39;: -0.07683151666360807}] source result
[{&#39;amp&#39;: 1, &#39;R_sersic&#39;: 0.10108487466803297, &#39;n_sersic&#39;: 2.957545832249977, &#39;e1&#39;: 0.08533573815979766, &#39;e2&#39;: 0.1593522237750895, &#39;center_x&#39;: 0.10268173391669946, &#39;center_y&#39;: 0.0011953395711379064}] lens light result
[] point source result
[] tracer source result
{} special param result
200.0184280872345 time used for  PSO
===================
MCMC selected. Sampling with default option emcee.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 400/400 [03:16&lt;00:00,  2.03it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing the MCMC...
Number of walkers =  100
Burn-in iterations:  200
Sampling iterations (in current run): 400
197.2988679409027 time taken for MCMC sampling
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="alert alert-warning">
<p><strong>Warning:</strong> This particular example was run with a very small and insufficiently long MCMC chain. This is for illustrative purpose only. You need to change the ‘n_burn’ and ‘n_run’ settings and make sure the chains are sufficiently converged to draw conclusions from the posteriors.</p>
</div>
</section>
<section id="texttt-lensmodelplot-class">
<h3><span class="math notranslate nohighlight">\(\texttt{LensModelPlot}\)</span> class<a class="headerlink" href="#texttt-lensmodelplot-class" title="Link to this heading">#</a></h3>
<p>The <span class="math notranslate nohighlight">\(\texttt{LensModelPlot}\)</span> facilitates the plotting of models, comparison with the data etc. This class is also meant to illustrate the post-processing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelPlot</span> <span class="o">=</span> <span class="n">ModelPlot</span><span class="p">([[</span><span class="n">kwargs_data</span><span class="p">,</span> <span class="n">kwargs_psf</span><span class="p">,</span> <span class="n">kwargs_numerics</span><span class="p">]],</span> <span class="n">kwargs_model</span><span class="p">,</span> <span class="n">kwargs_result</span><span class="p">,</span> <span class="n">arrow_size</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">cmap_string</span><span class="o">=</span><span class="s2">&quot;gist_heat&quot;</span><span class="p">)</span>
    
<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">modelPlot</span><span class="o">.</span><span class="n">data_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">model_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">normalized_residual_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">v_min</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span> <span class="n">v_max</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">source_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">deltaPix_source</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">numPix</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">convergence_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">v_max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">magnification_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">modelPlot</span><span class="o">.</span><span class="n">decomposition_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Lens light&#39;</span><span class="p">,</span> <span class="n">lens_light_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unconvolved</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">decomposition_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Lens light convolved&#39;</span><span class="p">,</span> <span class="n">lens_light_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">decomposition_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Source light&#39;</span><span class="p">,</span> <span class="n">source_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unconvolved</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">decomposition_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Source light convolved&#39;</span><span class="p">,</span> <span class="n">source_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">decomposition_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;All components&#39;</span><span class="p">,</span> <span class="n">source_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lens_light_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unconvolved</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">modelPlot</span><span class="o">.</span><span class="n">decomposition_plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;All components convolved&#39;</span><span class="p">,</span> <span class="n">source_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lens_light_add</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">point_source_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kwargs_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.9861271131799729 reduced X^2 of all evaluated imaging data combined (without degrees of freedom subtracted).
reduced chi^2 of data  0 =  0.9861271131799727
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/yp/rr1r4kgd2f3fpggf8vqnkqym0000gn/T/ipykernel_55411/1742186474.py:11: UserWarning: Tight layout not applied. tight_layout cannot make axes width small enough to accommodate all axes decorations
  f.tight_layout()
</pre></div>
</div>
<img alt="_images/70f8292d1fc8ed4246c87551f63e0e5ac24e8f3d826ae528bd8f0b2e37435f24.png" src="_images/70f8292d1fc8ed4246c87551f63e0e5ac24e8f3d826ae528bd8f0b2e37435f24.png" />
<img alt="_images/177a11370a11623018322f3d9ed3df1aa7018b5fb35e5bde4675b078299766c6.png" src="_images/177a11370a11623018322f3d9ed3df1aa7018b5fb35e5bde4675b078299766c6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;kwargs_lens&#39;: [{&#39;theta_E&#39;: 1.1001542220863012, &#39;gamma&#39;: 2.0, &#39;e1&#39;: 0.09230313967441728, &#39;e2&#39;: 0.10148791064197943, &#39;center_x&#39;: 0.10267914171226981, &#39;center_y&#39;: 0.0013785323210110515}, {&#39;gamma1&#39;: -0.014318819630151225, &#39;gamma2&#39;: 0.03294335353612951, &#39;ra_0&#39;: 0, &#39;dec_0&#39;: 0}], &#39;kwargs_source&#39;: [{&#39;amp&#39;: 92.32981312697395, &#39;R_sersic&#39;: 0.10217955626219474, &#39;n_sersic&#39;: 1.6123724805897017, &#39;center_x&#39;: 0.055013875157580175, &#39;center_y&#39;: -0.07654015575363507}], &#39;kwargs_lens_light&#39;: [{&#39;amp&#39;: 951.3805256079335, &#39;R_sersic&#39;: 0.10103203718030171, &#39;n_sersic&#39;: 2.9657281702191294, &#39;e1&#39;: 0.08586357305692166, &#39;e2&#39;: 0.1623716441384631, &#39;center_x&#39;: 0.10267914171226981, &#39;center_y&#39;: 0.0013785323210110515}], &#39;kwargs_ps&#39;: [], &#39;kwargs_special&#39;: {}, &#39;kwargs_extinction&#39;: [], &#39;kwargs_tracer_source&#39;: []}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lenstronomy.Plots</span> <span class="kn">import</span> <span class="n">chain_plot</span>

<span class="c1"># here we get the truths of the input that we aim to recover in the MCMC chain with the help of the Param() class.</span>
<span class="c1"># we can also get the Param() class instance from the FittingSequence() instancd</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">fitting_seq</span><span class="o">.</span><span class="n">param_class</span>
<span class="n">param_array_truths</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">kwargs2args</span><span class="p">(</span><span class="n">kwargs_lens</span><span class="p">,</span> <span class="n">kwargs_light_source</span><span class="p">,</span> <span class="n">kwargs_light_lens</span><span class="p">,</span> <span class="n">kwargs_ps</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chain_list</span><span class="p">)):</span>
    <span class="n">chain_plot</span><span class="o">.</span><span class="n">plot_chain_list</span><span class="p">(</span><span class="n">chain_list</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    
<span class="n">sampler_type</span><span class="p">,</span> <span class="n">samples_mcmc</span><span class="p">,</span> <span class="n">param_mcmc</span><span class="p">,</span> <span class="n">dist_mcmc</span>  <span class="o">=</span> <span class="n">chain_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of non-linear parameters in the MCMC process: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_mcmc</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parameters in order: &quot;</span><span class="p">,</span> <span class="n">param_mcmc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of evaluations in the MCMC process: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">samples_mcmc</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">corner</span>  <span class="c1"># pip install corner  (if you have not installed it)</span>

<span class="n">n</span><span class="p">,</span> <span class="n">num_param</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">samples_mcmc</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples_mcmc</span><span class="p">[:,:</span><span class="mi">8</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">param_mcmc</span><span class="p">[:</span><span class="mi">8</span><span class="p">],</span> <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">param_array_truths</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
<span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples_mcmc</span><span class="p">[:,</span><span class="mi">8</span><span class="p">:],</span> <span class="n">labels</span><span class="o">=</span><span class="n">param_mcmc</span><span class="p">[</span><span class="mi">8</span><span class="p">:],</span> <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">param_array_truths</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span>
<span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>number of non-linear parameters in the MCMC process:  15
parameters in order:  [&#39;theta_E_lens0&#39;, &#39;e1_lens0&#39;, &#39;e2_lens0&#39;, &#39;gamma1_lens1&#39;, &#39;gamma2_lens1&#39;, &#39;R_sersic_source_light0&#39;, &#39;n_sersic_source_light0&#39;, &#39;center_x_source_light0&#39;, &#39;center_y_source_light0&#39;, &#39;R_sersic_lens_light0&#39;, &#39;n_sersic_lens_light0&#39;, &#39;e1_lens_light0&#39;, &#39;e2_lens_light0&#39;, &#39;center_x_lens_light0&#39;, &#39;center_y_lens_light0&#39;]
number of evaluations in the MCMC process:  20000
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/yp/rr1r4kgd2f3fpggf8vqnkqym0000gn/T/ipykernel_55411/464015796.py:20: UserWarning: Matplotlib is currently using module://matplotlib_inline.backend_inline, which is a non-GUI backend, so cannot show the figure.
  plot.show()
/var/folders/yp/rr1r4kgd2f3fpggf8vqnkqym0000gn/T/ipykernel_55411/464015796.py:22: UserWarning: Matplotlib is currently using module://matplotlib_inline.backend_inline, which is a non-GUI backend, so cannot show the figure.
  plot.show()
</pre></div>
</div>
<img alt="_images/8ce5e083a636b8842165a2709da621416050bf7af2d87fe350642afb3b9db184.png" src="_images/8ce5e083a636b8842165a2709da621416050bf7af2d87fe350642afb3b9db184.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/9f3fc21b3c377ce88c01e2d4562645d70e435ea668a9f1c7739f81e7028a5784.png" src="_images/9f3fc21b3c377ce88c01e2d4562645d70e435ea668a9f1c7739f81e7028a5784.png" />
<img alt="_images/e19c3303af3e25f341365d02327736f35b1daf303d3f93266409027074e0d6f8.png" src="_images/e19c3303af3e25f341365d02327736f35b1daf303d3f93266409027074e0d6f8.png" />
<img alt="_images/76f07f302988b42d4743f8d0d1037b1ed3d6e35cb73e9a8c8f70257295cf51b1.png" src="_images/76f07f302988b42d4743f8d0d1037b1ed3d6e35cb73e9a8c8f70257295cf51b1.png" />
</div>
</div>
</section>
</section>
<section id="further-ressources">
<h2>Further ressources<a class="headerlink" href="#further-ressources" title="Link to this heading">#</a></h2>
<p>This notebook ends here. There are almost certainly many aspects or features that you were looking for that were not presented above. For additional features of each class, we refer to the documentation of the specific classes.
Here we provide few other pointers to notebooks that might be useful of features beyond of what was presented here:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/sibirrer/lenstronomy_extensions/blob/main/lenstronomy_extensions/Notebooks/units_coordinates_parameters.ipynb">Units, coordiante system and parameter definitions in lenstronomy</a></p></li>
<li><p><a class="reference external" href="https://github.com/sibirrer/lenstronomy_extensions/blob/main/lenstronomy_extensions/Notebooks/simulation_api.ipynb">SimulationAPI module for convenient simulations according to different instrument configurations</a></p></li>
<li><p>Modeling of point sources (<a class="reference external" href="https://github.com/sibirrer/lenstronomy_extensions/blob/main/lenstronomy_extensions/Notebooks/quad_model.ipynb">quad</a>, <a class="reference external" href="https://github.com/sibirrer/lenstronomy_extensions/blob/main/lenstronomy_extensions/Notebooks/double_model.ipynb">double</a>, <a class="reference external" href="https://github.com/sibirrer/lenstronomy_extensions/blob/main/lenstronomy_extensions/Notebooks/catalogue%20modelling.ipynb">catalogue level</a>)</p></li>
</ul>
<p>And many more notebooks available on the <a class="reference external" href="https://github.com/lenstronomy/lenstronomy-tutorials">lenstronomy_extension</a> repository!</p>
</section>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "lenstronomy"
        },
        kernelOptions: {
            name: "lenstronomy",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'lenstronomy'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="right-next"
       href="Notebooks/GettingStarted/starting_guide.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><em>lenstronomy</em> starting guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-lensmodel-module"><span class="math notranslate nohighlight">\(\texttt{LensModel}\)</span> module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-plane-lensing">Single plane lensing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-plane-lensing">Multi-plane lensing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lens-equation-solver">lens equation solver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#illustration-of-lens-models">illustration of lens models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-lightmodel-module"><span class="math notranslate nohighlight">\(\texttt{LightModel}\)</span> module</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-pointsource-module"><span class="math notranslate nohighlight">\(\texttt{PointSource}\)</span> module</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-data-module"><span class="math notranslate nohighlight">\(\texttt{Data}\)</span> module</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-imsim-module"><span class="math notranslate nohighlight">\(\texttt{ImSim}\)</span> module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-image">Simulate image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-inversion">Linear inversion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-sampling-module"><span class="math notranslate nohighlight">\(\texttt{Sampling}\)</span> Module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-param-class"><span class="math notranslate nohighlight">\(\texttt{Param}\)</span> class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-likelihood-class"><span class="math notranslate nohighlight">\(\texttt{Likelihood}\)</span> class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-sampler-class"><span class="math notranslate nohighlight">\(\texttt{Sampler}\)</span> class</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-workflow-module"><span class="math notranslate nohighlight">\(\texttt{Workflow}\)</span> Module</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-fittingsequence-class"><span class="math notranslate nohighlight">\(\texttt{FittingSequence}\)</span> class</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#texttt-lensmodelplot-class"><span class="math notranslate nohighlight">\(\texttt{LensModelPlot}\)</span> class</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-ressources">Further ressources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>
